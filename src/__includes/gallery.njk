{# GALLERY
------------------------------------------------
#}
{%- if env.mode != 'prod' %}
  <!-- __includes/gallery.njk  -->
{%- endif -%}


{% if gallery | length %}
  {# The slider window as open ? wrapper for the bacjgrioubd  #}
  <section aria-label="Image gallery"
  class=""
  x-data="{isSliderOpen: false}"
  :class="isSliderOpen ? 'fixed top-0 left-0 z-40 h-full w-full bg-black/90' : 'w-full relative mb-4 mt-4'"
  x-on:keydown.escape="isSliderOpen=false"
  x-on:keydown.left="$refs.slider.scrollBy(-$refs.slideitem1.clientWidth,0)"
  x-on:keydown.right="$refs.slider.scrollBy($refs.slideitem1.clientWidth,0)"
>


  <div class=""
  :class="isSliderOpen ? 'absolute top-1/2 w-full -translate-y-1/2':''";
  >
    {# pre next #}
    <button @click="$refs.slider.scrollBy(-$refs.slideitem1.clientWidth,0)"
          tabindex="0"
          type="button" aria-label="Previous"
          :class="isSliderOpen ? 'md:hidden' : 'md:block'"
          class="hidden bg-black text-white rounded-full w-10 h-10 absolute top-1/2 left-2 z-10 -translate-y-1/2">
      {% include "svg/left.njk" %}
    </button>

    <button @click="$refs.slider.scrollBy($refs.slideitem1.clientWidth,0)"
          tabindex="0"
          type="button" aria-label="Previous"
          :class="isSliderOpen ? 'md:hidden' : 'md:block'"
          class="hidden bg-black text-white rounded-full w-10 h-10 absolute top-1/2 right-2 z-10 -translate-y-1/2">
      {% include "svg/right.njk" %}
    </button>

    {# item links #}
    <nav aria-label="gallery navigation"
      class="flex flex-row space-x-2 max-w-md mx-auto z-10 absolute -top-4 right-0 transform "
      :class="isSliderOpen ? 'hidden' : ''"
      >
      {% for item in gallery %}
        <button
          @click="$refs.slideitem{{ loop.index }}.scrollIntoView(false)"
          class="bg-slate-500 text-white rounded-full w-3 h-3 text-sm"
          type="button"
        >
        {# {{ loop.index }} #}
        </button>
      {% endfor %}
      {# {{ gallery | length }} #}
    </nav>

    {# open/close toggler  #}
    <button
          type="button" aria-label="open close image"
          class="hidden md:block w-6 h-6 text-white z-10 absolute right-2 top-2"
          @click="isSliderOpen = !isSliderOpen, isModalOpen = !isModalOpen">
      <span x-show="isSliderOpen">
        {% include "svg/close.njk" %}
      </span>
      <span x-show="!isSliderOpen">
        {% include "svg/open.njk" %}
      </span>
    </button>

    {# Image wrapper for the gallery #}
    <div :class="isSliderOpen ? '' : 'scrollbar'"
        x-ref="slider"
        class="flex overflow-x-auto scroll-smooth snap-mandatory snap-x z-0">

      {# loop through all the images #}
      {% for item in gallery %}

        <div aria-label="image" role="img"
        x-ref="slideitem{{ loop.index }}"
        class="flex flex-shrink-0 overflow-auto relative md:aspect-video w-full h-full mr-2 snap-center transition"
        :class="isSliderOpen ? 'aspect-video justify-center items-center' : 'aspect-square'"
        >

      {# Generate image #}
        {% set img = page.inputPath | replace("index.md", item.image.image) %}
        {% set css = "rounded-sm" %}
        {% set format = [webp] %}
        {% set srcset = [400,800, 1600] %}
        {% set sizes = "(min-width: 1600px) 50vw, 100vw" %}
        {% if loop.index =='1' %}
          {% set loading = 'eger' %}
        {% else  %}
          {% set loading = 'lazy' %}
        {% endif %}
        {% image img, srcset, sizes, format, alt,css, loading %}
      {# / Generate image #}


          {# title and text #}
          {% if item.image.title or item.image.figcaption %}
            <div class="hidden absolute bottom-4 w-full bg-black/70 text-white text-center p-2">
              <div class="text-3xl">{{ item.image.title}}</div>
              <div class="text-lg">{{ item.image.figcaption}}</div>
            </div>
          {% endif %}

        </div>
      {% endfor %}
      {# images done  #}

    </div>

    {# gallery navigation #}
    <nav aria-label="gallery image navigation" class="flex flex-row my-4 space-x-4 max-w-lg mx-auto">
    {% for item in gallery %}

      <button
        @click="$refs.slideitem{{ loop.index }}.scrollIntoView(false)"
        class="block w-20 aspect-video overflow-hidden shadow hover:shadow-none"
        type="button"
      >
        <span class="sr-only">Link to image {{ loop.index }}</span>
      {{ loop.index }}

      </button>

    {% endfor %}
  </nav>
</div>
  </section>

{% endif %}
